FROM debian:latest

RUN apt-get update
RUN apt-get install -y gcc net-tools vim gdb python wget git make procps libpcre3-dev libdb-dev libxt-dev libxaw7-dev

#RUN cd /tmp; git clone -b exim-4_89+fixes --single-branch git://github.com/Exim/exim

COPY exim.tar.gz /tmp/exim.tar.gz

RUN cd /tmp && tar -zxvf exim.tar.gz

RUN mkdir /tmp/exim/src/Local

RUN cp /tmp/exim/src/EDITME /tmp/exim/Local/Makefile; cp /tmp/exim/exim_monitor/EDITME /tmp/exim/Local/eximon.conf

RUN adduser guest
RUN echo "EXIM_USER=guest" >> /tmp/exim/Local/Makefile
RUN echo "AUTH_PLAINTEXT=yes" >> /tmp/exim/Local/Makefile

COPY Makefile-Linux /tmp/exim/OS/Makefile-Linux

RUN cd /tmp/exim/; make install

COPY ./configure /usr/exim/configure

COPY key /opt/key
COPY start.sh /tmp/start.sh

EXPOSE 25

ENTRYPOINT "/tmp/start.sh"

# RUN /usr/exim/bin/exim -bd -q30m






